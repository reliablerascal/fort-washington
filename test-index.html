<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />

    <title>The Far Southeast Side's Disconnected Network of Public Parks</title>
    
    <!---hpmoon style is completely ignored-->
    <link rel="stylesheet" href="gitrascal_simple.css"> 
    
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/mapbox/assembly/publisher-staging/src/svgs/mapbox.svg">
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://unpkg.com/intersection-observer@0.12.0/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    
    <style>
        body {
            margin:0;
            padding:0;
            font-family: sans-serif;
        }
        a, a:hover, a:visited {
            color:#E3AE50;
        }
        /* this fixes the map at the top of the map container, which allows scrolling into fixed position from relative position  */
        /* per https://github.com/russellsamora/scrollama should avoid using vh?! */
        #map {
            position: sticky;
            top: 0;
            height:100vh;  
            width:100%;
        }
        #header h1, #header h2, #header p {
            margin: 0;
            padding: 2vh 2vw;
            text-align: center;
        }
        .hidden {
            visibility: hidden;
        }
        .centered {
            width: 50vw;
            margin: 0 auto;
        }
        .lefty {
            width: 33vw;
            margin-left: 5vw;
        }
        .righty {
            width: 33vw;
            margin-left: 62vw;
        }
        .fully {
            width: 100%;
            margin: auto;
        }
        .light {
            color: #0D506D;
            background-color: #F4F7D9;
            /* color: #444;
            background-color: #fafafa; */
        }
        .dark {
            color: #F4F7D9;
            background-color: #0D506D;
        }
        .step {
            padding-bottom: 50vh;
            /* margin-bottom: 10vh; */
            opacity: 0.25;
        }
        .step.active {
            opacity: 0.99;
        }

        .step div {
            padding:  25px 25px;
            line-height: 25px;
            font-size: 13px;
        }

        .step img {
            width: 100%;
        }

        @media (max-width: 750px) {
            .centered, .lefty, .righty, .fully {
                width: 90vw;
                margin: 0 auto;
            }
        }

        /* Fix issue on mobile browser where scroll breaks  */
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas {
            touch-action: unset;
        }

    </style>
</head>
<body>

<main id="content" class="neve-main" role="main">
<div id="intro">
<!---add margins to control width--->
<table width = 100%>
    <tr><td colspan=3>&nbsp;</td></tr>
    <td width = 50></td>
    <td>

    <h1>The Far Southeast Side's Disconnected Network of Public Parks</h1>
    <h3><em>Chicago's Southeast side possesses a natural wealth of lakefront and wetlands. But bikers can't yet safely access it.</em></h3>
    <p>by <a href="https://reliablerascal.github.io" target="_blank">Rob Reid</a><br><br>
    <em>8 September 2023</em><br>
    <!---<p><em>See <a href="https://github.com/reliablerascal/bike-far-southeast">GitHub repository</a> for methodology.</em>--->
    <br><br>
<img src="https://reliablerascal.github.io/bike-far-southeast/images/calumet-park-beach-fence-16-9.jpg" style="width: 100%;"></img>
<!---the image is 2400 wide by 1350 high-->

<div style="max-width: 800px; margin:0 auto; text-align: left; line-height: 25px;"> 
    <p>&nbsp;<p>&nbsp;<p>Countless drivers crisscross the rugged prairie of Chicago's Southeast Side, weaving around decaying steel mills, abandoned grain silos, landfills, and recycling plants. Traversing the Chicago Skyway, the Bishop Ford Freeway, or major thoroughfares like 130th Street and Torrence Avenue, motorists might not notice the lakefront beaches or wetland parks fashioned from former industrial sites reclaimed by the city in recent decades. They also might not notice the small number of people on foot and bike trying to find respite in these natural settings.<p>&nbsp;<p>&nbsp;
</div>

    </td><td width = 50></td></tr></table>
</div>

<!----------------------->
<!---    THE STORY     -->
<!----------------------->
<div id="map"></div>
<div id="story"></div><!-- this is the narrative corresponding to the map, as coded in config.js chapters--->
<!-- this adds text at the bottom, which can be seen as long as you can scroll out of the map--->
</main>

<footer>
    <div id="outro">
        <table width = 100%>
            <tr><td colspan=3>&nbsp;</td></tr>
            <td width = 50></td>
            <td>
                <div style="max-width: 800px; margin:0 auto; text-align: left; line-height: 25px;"> 
                <p>Building on this and other plans, Friends of Big Marsh published the <a href="https://bigmarsh.org/2023/07/14/east-side-community-connections-plan/" target="_blank">East Side Neighborhood Connectivity Plan</a>, which delves into a concrete feasibility plan and provides specific recommendations for how to make that work. As <a href="https://chi.streetsblog.org/2023/07/14/new-east-side-connectivity-plan-would-upgrade-condition-for-biking-to-big-marsh" target="_blank">Streetsblog noted in July</a>, that plan is a key step in building political will necessary to secure funding for bike and pedestrian transit improvements.

<p>While funding requirements are significant, improved access in the region would help area residents and visitors tap into an arguably greater wealth: the areaâ€™s abundant park space.

    <p><em>Streetsblog Chicago published a <a href="https://chi.streetsblog.org/2023/09/11/how-can-we-better-link-the-far-southeast-sides-disconnected-network-of-public-parks" target="_blank">version of this story on September 11, 2023.</a></em>

        <!-- <p>Methodology and data: see <a href="https://github.com/reliablerascal/bike-far-southeast">GitHub repository</a>.-->
            <p>
            <!---<p><em>Adapted from <a href="https://github.com/mapbox/storytelling" target="_blank">Mapbox Storytelling</a> template.</em>--->
        <!-- for hp moon style--></p>
        </div>
    </td><td width = 50></td></tr></table>
</div>
</footer>

<script src="config.js"></script>
<!-- <script src="./config.js"></script> -->
<script>
var initLoad = true;
var layerTypes = {
    'fill': ['fill-opacity'],
    'line': ['line-opacity'],
    'circle': ['circle-opacity', 'circle-stroke-opacity'],
    'symbol': ['icon-opacity', 'text-opacity'],
    'raster': ['raster-opacity'],
    'fill-extrusion': ['fill-extrusion-opacity'],
    'heatmap': ['heatmap-opacity']
}

var alignments = {
    'left': 'lefty',
    'center': 'centered',
    'right': 'righty',
    'full': 'fully'
}

function getLayerPaintType(layer) {
    // console.log('reading:' + layer);
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
}

function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        var options = {};
        if (layer.duration) {
            var transitionProp = prop + "-transition";
            options = { "duration": layer.duration };
            map.setPaintProperty(layer.layer, transitionProp, options);
        }
        map.setPaintProperty(layer.layer, prop, layer.opacity, options);
    });
}


/////////////////////////////////////////////
//                                         //
//         Standard Template               //
//                                         //
/////////////////////////////////////////////
var story = document.getElementById('story');
var features = document.createElement('div');
features.setAttribute('id', 'features');

config.chapters.forEach((record, idx) => {
    var container = document.createElement('div');

//RR attempt to set the container height so I can scroll past it. but the container is really the map div
//container.style.height = '300px';
//features.style.position = 'relative';

//color-code containers for debugging
// container.style.border = '1px solid red';
// features.style.border = '10px solid purple';

    var chapter = document.createElement('div');

    if (record.title) {
        var title = document.createElement('h3');
        title.innerText = record.title;
        chapter.appendChild(title);
    }

    if (record.image) {
        var image = new Image();
        image.src = record.image;
        chapter.appendChild(image);
    }

    if (record.caption) {
        var capt = document.createElement('figcaption');
        capt.innerHTML = record.caption;
        chapter.appendChild(capt);
    }

    if (record.description) {
        var story = document.createElement('p');
        story.innerHTML = record.description;
        chapter.appendChild(story);
    }

    container.setAttribute('id', record.id);
    container.classList.add('step');
    if (idx === 0) {
        container.classList.add('active');
    }

    chapter.classList.add(config.theme);
    container.appendChild(chapter);
    container.classList.add(alignments[record.alignment] || 'centered');
    if (record.hidden) {
        container.classList.add('hidden');
    }
    features.appendChild(container);
});

story.appendChild(features);

mapboxgl.accessToken = config.accessToken;

const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;
    const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";
    return {
      url: url + suffix
    }
}

var map = new mapboxgl.Map({
    container: 'map',
    style: config.style,
    center: config.chapters[0].location.center,
    zoom: config.chapters[0].location.zoom,
    bearing: config.chapters[0].location.bearing,
    pitch: config.chapters[0].location.pitch,
    interactive: false,
    transformRequest: transformRequest,
    projection: config.projection
});


if (config.showMarkers) {
    var marker = new mapboxgl.Marker({ color: config.markerColor });
    marker.setLngLat(config.chapters[0].location.center).addTo(map);
}

// instantiate the scrollama
var scroller = scrollama();

const markerColor = '#008080';

//'filter': ["==", "PublicationName", "El Especial / El Especialito"],
map.on("load", function() {
    //for debugging, list out all layers within my style
    // var style = map.getStyle();
    // if (style && style.layers) {
    //     style.layers.forEach(function(layer) {
    //         console.log(layer.id); // logging the layer id, you can log other properties if needed
    //     });
    // }
    
    //adding code here via Steph to incorporate my own GeoJSON points layer
    map.addSource('geo-bike-chicago-se', {
         'type': 'geojson',
         'data': 'data/bike-chicago-se.geojson'
     });
     map.addLayer({
         'id': 'point-100th-viaduct',
         'type': 'circle',
         'source': 'geo-bike-chicago-se',
         'filter': ["==", "name", "point-100th-viaduct"],
         'paint': {
             'circle-color': markerColor,
             'circle-stroke-color': '#4d4d4d',
             'circle-stroke-width': 0.5,
             'circle-radius': 15,
             'circle-opacity': 0,
             'circle-stroke-opacity': 0
         },
     });
     map.addLayer({
         'id': 'point-bridge-burnham-brainard',
         'type': 'circle',
         'source': 'geo-bike-chicago-se',
         'filter': ["==", "name", "point-bridge-burnham-brainard"],
         'paint': {
             'circle-color': markerColor,
             'circle-stroke-color': '#4d4d4d',
             'circle-stroke-width': 0.5,
             'circle-radius': 15,
             'circle-opacity': 0,
             'circle-stroke-opacity': 0
         },
     });
     map.addLayer({
         'id': 'path-lcbn-august',
         'type': 'line',
         'source': 'geo-bike-chicago-se',
         'filter': ["==", "name", "path-lcbn-august"],
         'paint': {
            'line-color': 'green',
            'line-width': 5,
            'line-opacity': 0//,
            //'line-dasharray': [5, 5]
        },
     });
     map.addLayer({
         'id': 'path-lcbn-september',
         'type': 'line',
         'source': 'geo-bike-chicago-se',
         'filter': ["==", "name", "path-lcbn-september"],
         'paint': {
            'line-color': 'green',
            'line-width': 5,
            'line-opacity': 0//,
            //'line-dasharray': [5, 5]
        },
     });

//add map- lakeshore trail
     map.addSource('path-lakeshore-trail', {
         'type': 'geojson',
         'data': 'data/lakeshore-trail.geojson'
     });
     map.addLayer({
         'id': 'path-lakeshore',
         'type': 'line',
         'source': 'path-lakeshore-trail',
         'filter': ["==", "name", "lakeshore-trail"],
         'paint': {
            'line-color': '#846ce4',
            'line-width': 5,
            'line-opacity': 0//,
            //'line-dasharray': [5, 5]
        },
     });

//add map- Iroquois Landing
     map.addSource('iroquois-landing', {
         'type': 'geojson',
         'data': 'data/iroquois-landing.geojson'
     });
     map.addLayer({
         'id': 'park-iroquois-landing',
         'type': 'fill',
         'source': 'iroquois-landing',
         'filter': ["==", "name", "iroquois-landing"],
         'paint': {
            'fill-color': '#739041',
            'fill-opacity': 0
        },
     });

     //debug: check whether my points are found and loaded
     //sub in the SOURCE name in all areas, the feature name ONLY in the features.length section
//      if (map.isSourceLoaded('iroquois-landing')) {
//         checkSourceFeatures();
//     } else {
//         map.on('sourcedata', function(event) {
//             if (event.sourceId === 'iroquois-landing' && map.isSourceLoaded('iroquois-landing')) {
//                 checkSourceFeatures();
//             }
//         });
//     };
//     function checkSourceFeatures() {
//     const features = map.querySourceFeatures('iroquois-landing', {
//         filter: ["==", "name", "park-iroquois-landing"]
//     });

//     if (features.length > 0) {
//         console.log("Found the path 'park-iroquois-landing' in the source!");
//     } else {
//         console.log("No path found with the name 'park-iroquois-landing'.");
//     }
// };

    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 0.5, //1 = begins when container hits top, 0.5 begins when it's 1/2 screen up
        progress: true
    //    , debug: true //creates a line to see where scroller initiates
    })
    .onStepEnter(async response => {
        var current_chapter = config.chapters.findIndex(chap => chap.id === response.element.id);
        var chapter = config.chapters[current_chapter];

        response.element.classList.add('active');
        map[chapter.mapAnimation || 'flyTo'](chapter.location);

        // Incase you do not want to have a dynamic inset map,
        // rather want to keep it a static view but still change the
        // bbox as main map move: comment out the below if section.
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
        if (chapter.callback) {
            window[chapter.callback]();
        }
        if (chapter.rotateAnimation) {
            map.once('moveend', () => {
                const rotateNumber = map.getBearing();
                map.rotateTo(rotateNumber + 180, {
                    duration: 30000, easing: function (t) {
                        return t;
                    }
                });
            });
        }
        if (config.auto) {
             var next_chapter = (current_chapter + 1) % config.chapters.length;
             map.once('moveend', () => {
                 document.querySelectorAll('[data-scrollama-index="' + next_chapter.toString() + '"]')[0].scrollIntoView();
             });
        }
    })
    
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
    });


    if (config.auto) {
        document.querySelectorAll('[data-scrollama-index="0"]')[0].scrollIntoView();
    }
});


// setup resize event
window.addEventListener('resize', scroller.resize);

</script>


</body>
<!---</main>--->
<!---close out hp moon style-->
</html>
